# SAML Single Sign-On Integration

DataRobot could use external services (Identity Providers, IdP) for user authentication through Single Sign-On (SSO) technology. DataRobot supports SSO based on SAML protocol.

(<span style="color:red">NOTE: SSO described in this section will be deprecated in DataRobot 7.1. Please, configure instead Enhanced SSO described in the section [Enhanced SAML Single Sign-On (SSO)](#Enhanced-SAML-Single-Sign-On-(SSO))!</span>)

## Enable Single Sign-On

Single Sign-On feature is disabled by default. Update your `config.yaml` to enable SSO:

```yaml
---
app_configuration:
    drenv_override:
        ENABLE_SAML_SSO: true
```

## SSO Configuration Permissions

SSO configuration is disabled by default. There is a flag `Enable SAML SSO configuration management` to enable it. `Manage SSO` tab appears under `APP ADMIN` when `Enable SAML SSO configuration management` is checked.

## SSO Configuration

Single Sign-On should be configured on both Identity Provider and DataRobot sides.

### Identity Provider configuration

Identity Providers implement their own dashboards, so customer should reach IdP's documentation to integrate DataRobot. IdP requires from DataRobot sign in and sign out urls. They are represented on the `Manage SSO` page under `Single Sign-On URL` and `Single Sign-Out URL` settings.
DataRobot expects to receive username and email from the identity provider. IdP should be configured so that the SAML response contains `username` attribute (mandatory) and `email` attribute (optional, recommended).

### DataRobot configuration

`Manage SSO` page represents form for SSO configuration. It has following configuration fields:

* `Entity Id` - Unique identifier. Provided by Identity Provider
* `IdP Metadata URL` - link to XML document with integration specific information

There are following settings in advanced configuration:

* `User Session Length (sec)` - Session cookie expiration time. Default is month
* `SP Initiated Method` - SAML method which is used to start authentication negotiation
* `IdP Initiated Method` - SAML method which is used to move user to DataRobot after successful authentication
* `Identify Provider Metadata` - XML document with integration specific information (for the case IdP doesn't provide `IdP Metadata URL`)

<img src="images/sso-saml-configuration.png" alt="SSO SAML Configuration" style="border: 1px solid black;" width="500" />

### User impersonation

In order to enable user impersonation on environments with SAML SSO please put the following to `config.yaml`:

```yaml
---
app_configuration:
    drenv_override:
        ENABLE_USER_IMPERSONATION: true
```

The username to use for impersonation will be take from attribute `impersonation_user` of SAML response.

## Sign In

After SSO is configured, Single Sign-On button appears on sign in screen. User is redirected to Identity Provider's authentication page after clicking on it.

User is redirected to DataRobot after successful sign on.

## Base Configuration Examples

## AWS SSO

1. Navigate to the SSO page (from the **Services** tab) and click **Enable AWS SSO**

<kbd><img src="images/sso-saml-aws-config-1.png" alt="AWS SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

2. Click on **Manage SSO access to your cloud applications > Add a new application > Add a custom SAML 2.0 application**:

<kbd><img src="images/sso-saml-aws-config-2.png" alt="AWS SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

<kbd><img src="images/sso-saml-aws-config-3.png" alt="AWS SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

<kbd><img src="images/sso-saml-aws-config-4.png" alt="AWS SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

3. **Display name** will appear in the user portal and may be an arbitrary name

<kbd><img src="images/sso-saml-aws-config-5.png" alt="AWS SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

4. Copy autogenerated **AWS SSO SAML metadata file** and save this URL as **IdP Metadata URL** on
   the DataRobot SSO Configuration page:

<kbd><img src="images/sso-saml-aws-config-6.png" alt="AWS SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

5. Specify application metadata. **Application ACS URL** should be `<domain>/sso/saml/signed-in` and
   **Application SAML audience** might be an arbitrary string

<kbd><img src="images/sso-saml-aws-config-7.png" alt="AWS SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

<kbd><img src="images/sso-saml-aws-config-8.png" alt="AWS SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

6. Save **Application SAML audience** value as **Entity Id** on the DataRobot SSO Configuration
   Page. Also, make sure that **Advanced settings** contain **REDIRECT** in **SP Initiated Method**
   and **POST** in **IdP Initiated Method**

7. On the **Attribute mappings** tab specify and save the following mappings:

	* `Subject` - `subject` - `transient`
	* `username` - `${user:email}` - `unspecified`

<kbd><img src="images/sso-saml-aws-config-9.png" alt="AWS SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

8. Assign users or groups to grant SSO access

<kbd><img src="images/sso-saml-aws-config-10.png" alt="AWS SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>


## Microsoft Azure SSO

1. Sign in to the  [Azure portal](https://portal.azure.com/) as a cloud application admin. In the
   portal, select **Azure Active Directory > Enterprise applications** and select **New application**

<kbd><img src="images/sso-saml-azure-config-1.png" alt="Azure SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

2. Select **Integrate any other application you don’t find in the gallery**, enter the display name,
   then click **Add**

<kbd><img src="images/sso-saml-azure-config-2.png" alt="Azure SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

3. On the app’s **Overview** page, select **Set up single sign-on**, then select **SAML** as the
   single sign-on method

<kbd><img src="images/sso-saml-azure-config-3.png" alt="Azure SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

4. Edit **Basic SAML Configuration**. Type **Identifier (Entity ID)** (an arbitrary string), type
   **Reply URL (Assertion Consumer Service URL)** which should be `<domain>/sso/saml/signed-in/`,
   then save

<kbd><img src="images/sso-saml-azure-config-4.png" alt="Azure SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>


5. Configure **User Attributes & Claims**. Delete all default additional claims and add new claim
   with `username` as **Name**, `Attribute` as **Source**, and `user.userprincipalname` as **Source attribute**.
   If the form prevents saving without **Namespace** value, provide any string, save, then edit it again
   and make **Namespace** empty. After saving the new claim will appear in the table

<kbd><img src="images/sso-saml-azure-config-5.png" alt="Azure SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

6. Add at least one user to the application and make sure the test account has access to the
   application

<kbd><img src="images/sso-saml-azure-config-6.png" alt="Azure SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

7. Copy **Identifier (Entity ID)** and **App Federation Metadata Url** and save them as **Entity ID**
   and **IdP Metadata URL** in the DataRobot SSO Configuration page

<kbd><img src="images/sso-saml-azure-config-7.png" alt="Azure SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

<kbd><img src="images/sso-saml-azure-config-8.png" alt="Azure SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

8. Test sign on by hitting **Test** button in step 5, the result should be

<kbd><img src="images/sso-saml-azure-config-9.png" alt="Azure SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

## Oracle Identity Cloud Service SSO

1. Having logged in into Oracle Cloud Console as an administrator navigate to **Service User Console**
   and select **Oracle Identity Cloud Service**

<kbd><img src="images/sso-saml-oracle-config-1.png" alt="Oracle SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

<kbd><img src="images/sso-saml-oracle-config-2.png" alt="Oracle SSO SAML Configuration" style="border: 1px solid black;" width="250" height="350" /></kbd>

2. Click on **Add an application** icon and select **SAML Application**

<kbd><img src="images/sso-saml-oracle-config-3.png" alt="Oracle SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

<kbd><img src="images/sso-saml-oracle-config-4.png" alt="Oracle SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

3. On **App Details** page provide an arbitrary name of the application and hit **Next**

<kbd><img src="images/sso-saml-oracle-config-5.png" alt="Oracle SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

4. On **SSO Configuration** page specify the following values:

* **Entity ID** - unique name for a service provider, an arbitrary string, should be the same
  as **Entity Id** on DataRobot **Single Sign On Configuration** page

* **Assertion Consumer URL** - **Single Sign-On URL** value copied from DataRobot
  **Single Sign On Configuration** page, has form of `<domain>/sso/saml/signed-in/`

* **NameID Format** - select **Custom** and specify `urn:oasis:names:tc:SAML:2.0:nameid-format:transient`
  value

* **NameID Value** - select **Primary Email**

* In **Attribute Configuration** section add an attribute with username as **Name**,
  select Unspecified as **Format**, User Attribute as **Type**, and Primary Email as **Value**

<kbd><img src="images/sso-saml-oracle-config-6.png" alt="Oracle SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

5. Hit **Finish**

6. Go back to **SSO Configuration** tab and click **Download Identity Provider Metadata**.
   Copy the content of downloaded **IDCSMetadata.xml** file and save as **Identity Provider Metadata**
   on DataRobot **Single Sign On Configuration** page. Also, make sure that **IdP Metadata URL**
   field is empty

<kbd><img src="images/sso-saml-oracle-config-7.png" alt="Oracle SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

<kbd><img src="images/sso-saml-oracle-config-8.png" alt="Oracle SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

7. Activate the application

<kbd><img src="images/sso-saml-oracle-config-9.png" alt="Oracle SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

8. Assign users or groups on a corresponding tab

<kbd><img src="images/sso-saml-oracle-config-10.png" alt="Oracle SSO SAML Configuration" style="border: 1px solid black;" width="500" /></kbd>

9. Test the application integration by logging in into DataRobot using user assigned
   on the previous step

## Advanced SSO Configuration

Some advanced configuration options are not exposed in UI and are
available via admin SSO configuration API.

In order to use that API administrator needs to have regular SSO
management permissions and grab API token from own profile in UI
(referred as `<API_TOKEN>` below).

### Encrypted Request

In order to enable authentication request signing please

1. put your encryption certificate and key files into `/opt/datarobot/DataRobot-7.x.x/etc/certs/`,
2. configure the application:

```bash
curl '<DATAROBOT_ENDPOINT>/api/v2/admin/sso/saml/configuration/global/' -X PATCH -H 'Content-Type: application/json;charset=UTF-8' -H 'Authorization: Token <API_TOKEN>' --data-binary '
{
  "advancedConfiguration": {
    "samlClientConfiguration": {
      "service": {"sp": {"authn_requests_signed": true}},
      "key_file" : "/opt/datarobot/etc/certs/key.pem",
      "cert_file" : "/opt/datarobot/etc/certs/cert.pem"
    }
  }
}'
```

### Encrypted Response

If SAML identity provider encrypts response assertions, please

1. put your encryption certificate and key files into `/opt/datarobot/DataRobot-7.x.x/etc/certs/`,
2. configure the application to use that certificate:

```bash
curl '<DATAROBOT_ENDPOINT>/api/v2/admin/sso/saml/configuration/global/' -X PATCH -H 'Content-Type: application/json;charset=UTF-8' -H 'Authorization: Token <API_TOKEN>' --data-binary '
{
  "advancedConfiguration": {
    "samlClientConfiguration": {
      "encryption_keypairs" : [{
        "key_file" : "/opt/datarobot/etc/certs/key.pem",
        "cert_file" : "/opt/datarobot/etc/certs/cert.pem"
      }]
    }
  }
}'
```

#### Encrypted Response with Okta

When using encrypted assertions with Okta, please additionally specify `id_attr_name`:

```bash
curl '<DATAROBOT_ENDPOINT>/api/v2/admin/sso/saml/configuration/global/' -X PATCH -H 'Content-Type: application/json;charset=UTF-8' -H 'Authorization: Token <API_TOKEN>' --data-binary '
{
  "advancedConfiguration": {
    "samlClientConfiguration": {
      "encryption_keypairs" : [{
        "key_file" : "/opt/datarobot/etc/certs/key.pem",
        "cert_file" : "/opt/datarobot/etc/certs/cert.pem"
      }],
      "id_attr_name" : "Id"
    }
  }
}'
```

## Enhanced SAML Single Sign-On (SSO)

Enhanced SAML SSO beside authentication provides a number of improvements in sense of users provisioning and simplified configuration of security and advanced parameters.

## Enable SSO

SSO is disabled by default. Update your `config.yaml` to enable enhanced SSO:

```yaml
---
app_configuration:
    drenv_override:
        PLATFORM_TYPE: enterprise
        ENABLE_SAML_SSO: false
        ENABLE_ENHANCED_GLOBAL_SAML_SSO: true
```

NOTE:

- One does not need to backup/dump the old SSO config, the new config is created and stored separately. The new config is created either with default values (if there was no old config) or based on old SSO config values. The old config is kept for the case if one needs to switch back to the old SSO.
- However one has to update signed-in SSO route (aka Assertion Consumer Service URL) at IdP. The route format is `https://<host>/sso/signed-in/`. Pay attention for route protocol (HTTP vs HTTPS), modify it if required.

### SSO Configuration Permissions

SSO configuration is disabled by default. There is a per user flag `Enable Enhanced Global SAML SSO configuration management` to enable it (find this flag in the user account settings). `Manage SSO` tab appears under `APP ADMIN` when `Enable Enhanced Global SAML SSO configuration management` is checked. Note, the configuration is accessible only by system administrators.

### SSO Configuration

Single Sign-On should be configured on both Identity Provider (IdP) and DataRobot sides.

#### Identity Provider configuration

Identity Providers (IdP) implement their own dashboards, so customer should reach IdP's documentation to integrate DataRobot. IdP requires from DataRobot sign in and sign out URLs. They are represented on the `Manage SSO` page in section `Service provider details` under `SP initiated login URL` and `IdP initiated login URL` settings, where SP stands for Service Provider which is DataRobot app in this case. DataRobot expects to receive username and email from the identity provider. IdP should be configured such that the SAML response contains `username` attribute (mandatory) and `email` attribute (optional, recommended).

#### DataRobot configuration

`Manage SSO` page represents form for SSO configuration. It consists of the following sections.

##### Single Sign On and Service Provider details
<img src="images/sso_saml_enhanced_config_a.png" alt="SSO SAML Configuration. Single Sign On and Service Provider details sections." style="border: 1px solid black;" width="600" />

* `Enable single sign on` - enables SSO, if checked then SSO appears on the landing page and corresponding SSO routes accepts requests.
* `Enforce single sign on` - enforces SSO, user can only login by SSO (cannot use its username and password).
* `SP initiated login URL` - The endpoint DR app uses for initiating SSO authentication request to IdP (note, the default schema is HTTPS).
* `IdP initiated login URL` - The endpoint that receives the SAML sign-in request from the IdP. This URL also known as Assertion Consumer Service (ACS) URL (note, the default schema is HTTPS).
* `IdP initiated logout URL` - Optional. The endpoint that receives the SAML sign-out request from the IdP (note, the default schema is HTTPS).
* `Save` - click to save the changes.

##### Configure / Metadata URL
There are three option of how one can configure the IdP parameters, namely Metadata URL, Metadata file, Manual settings.

<img src="images/sso_saml_enhanced_config_b.png" alt="SSO SAML Configuration. Configure using Metadata URL." style="border: 1px solid black;" width="400" />

* `Entity Id` - Unique identifier. Provided by Identity Provider.
* `Metadata URL` - URL to the XML document with information required for integration with IdP.
* `Verify IdP Metadata HTTPS Certificate` - once is checked and the Metadata URL is of HTTPS schema then it is checked for valid certificate.

##### Configure / Metadata file

Metadata file allows user to provide IdP metadata as XML content.

<img src="images/sso_saml_enhanced_config_c.png" alt="SSO SAML Configuration. Configure using Metadata file." style="border: 1px solid black;" width="400" />

* `Entity Id` - Unique identifier. Provided by Identity Provider.
* `Metadata file` - IdP Metadata content as XML document. User has to retrieve this content from corresponding IdP. This option should be used when there is no way to have IdP Metadata URL.

##### Configure / Manual settings

This option is used, if IdP metadata is not available. DR app generates it based on the following fields.

<img src="images/sso_saml_enhanced_config_d.png" alt="SSO SAML Configuration. Configure using Manual settings." style="border: 1px solid black;" width="400" />

* `Entity Id` - Unique identifier. Provided by Identity Provider.
* `Identity Provider Single Sign On URL` - The URL that DataRobot contacts to initiate login authentication for the user. This is obtained from the SAML application you created for DataRobot in the IdP configuration (KeyCloak example: http://host/auth/realms/dr-realm/protocol/saml).
* `Identity Provider Single Sign-Out URL (optional)` - The URL that DataRobot directs the user’s browser to after logout. This is obtained from the SAML application you created for DataRobot in the IdP configuration. If left blank, DatRobot redirects to the root DataRobot site.
* `Issuer` - The IdP-provided Entity ID obtained from the SAML application you created for DataRobot in the IdP configuration (KeyCloak example: http://host/auth/realms/dr-realm).
* `Certificate` - IdP X.509 certificate, pasted or uploaded. The certificate is obtained from the IdP side. The certificate is used by SP for verifying the IdP signatures (e.g., it is a corresponding realm certificate in case of KeyCloak).

##### User provisioning

<img src="images/sso_saml_enhanced_config_e.png" alt="SSO SAML Configuration. User provisioning." style="border: 1px solid black;" width="400" />

* `Auto-generate Users` - if checked then newly signed-on user is created in the DataRobot database.

##### Mapping between DataRobot and the IdP

There are three mapping options: Attributes, Groups, Roles. All three options allow to set up users attributes/groups/roles mappings between Identity Provider and DataRobot. Those mapping is used during automatic user provisioning.

Adding mappings adds more restrictions on who can access DataRobot and also controls what users can access.

###### Mapping / Attributes

Attribute mapping allows one to map DataRobot attributes (data about the user, e.g., first name, last name) to the fields of the SAML response. In other words, because DataRobot and the IdP may use different fields' names, this section allows you to configure the name of the field in the SAML response where DataRobot updates the user’s display name, first name, last name, and email.

<img src="images/sso_saml_enhanced_config_f.png" alt="SSO SAML Configuration. Mapping / Attributes." style="border: 1px solid black;" width="400" />

###### Mapping / Groups

Use the Groups mapping to create an unlimited number of mappings between IdP groups and existing DataRobot groups. Mappings can be one-to-one, one-to-many, or many-to-many.

<img src="images/sso_saml_enhanced_config_g.png" alt="SSO SAML Configuration. Mapping / Groups." style="border: 1px solid black;" width="400" />

To configure, set:
* Group attribute: The name, in the SAML response, that identifies the string as a group name.
* DataRobot group: The name of an existing DataRobot group to which the user will be assigned.
* Identity provider group: The name of the IdP group to which the user belongs.

###### Mapping / Roles

Use the Roles mapping to create an unlimited number of mappings between IdP and DataRobot roles. Mappings can be one-to-one, one-to-many, or many-to-many.

<img src="images/sso_saml_enhanced_config_h.png" alt="SSO SAML Configuration. Mapping / Roles." style="border: 1px solid black;" width="400" />

To configure, set:

* Role attribute: The name, in the SAML response, that identifies the string as a named user role.
* DataRobot role: The name of the DataRobot role to assign to the user.
* Identity provider role: The name of the role in the IdP configuration that is assigned to the user.

##### Security Parameters

The following options are strengthening or weakening the security of the SAML protocol.

<img src="images/sso_saml_enhanced_config_i.png" alt="SSO SAML Configuration. Security Parameters." style="border: 1px solid black;" width="400" />

* `Allow unsolicited` - when checked, the DataRobot app (SP) consumes unsolicited SAML Responses, i.e. SAML Responses for which it has not sent a respective SAML Authentication Request.
* `Auth Requests Signed` - when checked, the Authentication Requests sent by this DataRobot app are signed. Note, signing works only when the primary key is provided by this part described in the section Advanced Options / Client Config / SAML Config.
* `Want Assertions Signed` - Indicates if this DataRobot app wants the IdP to send the assertions signed. This sets the WantAssertionsSigned attribute of the SPSSODescriptor node of the metadata so the Identity Provider (IdP) will know this preference.
* `Want Response Signed` - Indicates that Authentication Responses to the DataRobot app must be signed. If checked, the DataRobot app does not consume any SAML Responses that are not signed.
* `Logout Requests Signed` - Indicates if this entity will sign the Logout Requests originated from it.

##### Advanced Options / Session & Binding

<img src="images/sso_saml_enhanced_config_j.png" alt="SSO SAML Configuration. Advanced Options / Session & Binding." style="border: 1px solid black;" width="400" />

* `User Session Length (sec)` - Session cookie expiration time.
* `SP Initiated Method` - SAML method which is used to start authentication negotiation.
* `IdP Initiated Method` - SAML method which is used to move user to DataRobot after successful authentication.

##### Advanced Options / Client Config

<img src="images/sso_saml_enhanced_config_k.png" alt="SSO SAML Configuration. Advanced Options / Client Config." style="border: 1px solid black;" width="400" />

* `Digest Algorithm` - A message digest algorithm used for calculating hash values.
* `Signature Algorithm` - An algorithm used for producing signatures.
* `SAML Config` - allows to provide fine tuning configuration for SAML client by providing JSON object. Here is, for instance, how one could set primary key:
```json
{
  "key_file": "/opt/datarobot/etc/secrets/key_for_client.pem"
}
```
where `key_file` is a path to the key pem file. Or alternatively one could upload secrets by content providing the following JSON:
```json
{
  "key_file_value": "-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"
}
```
same is valid for certificate file (user `cert_file_value` in that case).

#### User impersonation

In order to enable user impersonation on environments with SAML SSO please put the following to `config.yaml`:

```yaml
---
app_configuration:
    drenv_override:
        ENABLE_USER_IMPERSONATION: true
```

The username to use for impersonation will be take from attribute `impersonation_user` of SAML response.

### Sign In

After SSO is configured, Single Sign-On button appears on the landing page of DataRobot app. User is redirected to Identity Provider's authentication page after clicking it.

User is redirected to DataRobot after successful sign on.

### Basic Examples

The basic example described in the following section [Base Configuration Examples](#base-configuration-examples) are also valid for the enhanced global SSO. The differences one may face are:

* `<domain>/sso/signed-in/` has to be provided as Assertion Consumer Service URL (instead of `<domain>/sso/saml/signed-in/`).
* Use config section [Configure / Metadata URL](#Configure-/-Metadata-URL), if IdP metadata is provided by URL.
* Use config section [Configure / Metadata file](#Configure-/-Metadata-file), if IdP metadata is provided as content.


## Advanced Enhanced SSO Configuration

Compare to the old [Advanced SSO Configuration](#Advanced-SSO-Configuration) one can set encryption keys/certificates and security flags right at UI.

### Encrypted Request

In order to enable authentication request signing, please, follow the steps:

* put your encryption certificate and key files into `/opt/datarobot/DataRobot-7.x.x/etc/certs/`,
* create JSON file:
```json
{
  "key_file": "/opt/datarobot/DataRobot-7.x.x/etc/certs/key.pem",
  "cert_file" : "/opt/datarobot/DataRobot-7.x.x/etc/certs/cert.pem"
}
```

* configure the application:
  - uploading JSON file using `SAML Config` described in the [Advanced Options / Client Config](#Advanced-Options-/-Client-Config) section.
  - set security flag `Auth Requests Signed` described in the [Security Parameters](#Security-Parameters) section.

### Encrypted Response

If SAML identity provider encrypts response assertions, please, follow the steps:

* put your encryption certificate and key files into `/opt/datarobot/DataRobot-7.x.x/etc/certs/`,
 create JSON file (alternatively one could use fields `key_file_value`, `cert_file_value` to specify the key and cert files contnet directly):
```json
{
  "encryption_keypairs" : [{
    "key_file" : "/opt/datarobot/DataRobot-7.x.x/etc/certs/key.pem",
    "cert_file" : "/opt/datarobot/DataRobot-7.x.x/etc/certs/cert.pem"
  }]
}
```
* configure the application to use that certificate by uploading JSON file using `SAML Config` described in the  [Advanced Options / Client Config](#Advanced-Options-/-Client-Config) section.

#### Encrypted Response with Okta

When using encrypted assertions with Okta, please additionally specify `id_attr_name_crypto` in the JSON file:

```json
{
  "encryption_keypairs" : [{
    "key_file" : "/opt/datarobot/DataRobot-7.x.x/etc/certs/key.pem",
    "cert_file" : "/opt/datarobot/DataRobot-7.x.x/etc/certs/cert.pem"
  }],
  "id_attr_name_crypto" : "Id"
}
```
